{% load static %}
{% load staticfiles %}

<!doctype html>
<html lang="en">
<head>
	<meta charset="utf-8" />
	{% include 'css.html' %}
	{% include 'javascript.html' %}
	<link rel="icon" type="image/png" href="assets/img/favicon.ico">
	<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />

	<title>ArchiTasker - Week Planner Made Simple</title>

	<meta content='width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0' name='viewport' />
    <meta name="viewport" content="width=device-width" />


    <!-- Bootstrap core CSS     -->
    <link href="{% static 'css/DASHBOARD_CSS/bootstrap.min.css' %}" rel="stylesheet" />

    <!-- Animation library for notifications   -->
    <link href="{% static 'css/DASHBOARD_CSS/animate.min.css' %}" rel="stylesheet"/>

    <!--  Light Bootstrap Table core CSS    -->
    <link href="{% static 'css/DASHBOARD_CSS/light-bootstrap-dashboard.css' %}" rel="stylesheet"/>


    <!--  CSS for Demo Purpose, don't include it in your project     -->
    <link href="{% static 'css/DASHBOARD_CSS/demo.css' %}" rel="stylesheet" />


    <!--     Fonts and icons     -->
    <link href="http://maxcdn.bootstrapcdn.com/font-awesome/4.2.0/css/font-awesome.min.css" rel="stylesheet">
    <link href='http://fonts.googleapis.com/css?family=Roboto:400,700,300' rel='stylesheet' type='text/css'>
    <link href="{% static 'css/DASHBOARD_CSS/pe-icon-7-stroke.css' %}" rel="stylesheet" />





		<script type="text/javascript" charset="utf-8">

			function init() {
				google_ids = [];

				var currently_selected_id = "";
				var current_view = 0;
				var prev_button = document.getElementsByClassName('dhx_cal_prev_button');
				var next_button = document.getElementsByClassName('dhx_cal_next_button');
				next_button[0].style.visibility='hidden';

				// HANDLE PREVIOUS EVENTS
				for (var i = 0; i < prev_button.length; i++) {
						prev_button[i].addEventListener('click', function() {
								current_view-=1;
								if (current_view > 0) {
									next_button[0].style.visibility='hidden';
								}
								else {
									next_button[0].style.visibility='visible';
								}
						});
				}
				// HANDLE FUTURE EVENTS
				for (var i = 0; i < next_button.length; i++) {
						next_button[i].addEventListener('click', function() {
								current_view+=1;
								if (current_view >= 0) {
									next_button[0].style.visibility='hidden';
								}
								else {
									next_button[0].style.visibility='visible';
								}
						});
				}

				scheduler.config.full_day = true;

				scheduler.config.xml_date="%Y-%m-%d %H:%i";

				scheduler.config.default_date = "%j %M %Y";

				var formatDateFunc = scheduler.date.date_to_str("%Y-%m-%dT%H:%i:%s");

				var weekDay = scheduler.date.date_to_str("%D")

				// I think this is where the bug is where the data posting to the view is causing the error for the start and end times
				var updateDayStatus = function(event_id, ev) {

					$('.ajaxProgress').show();
					$.ajax({
						type: "POST",
						url: "create_event/",
						dataType: "json",
						data: {
							csrfmiddlewaretoken: '{{ csrf_token }}',
							start: formatDateFunc(scheduler.getEvent(event_id).start_date),
							end: formatDateFunc(scheduler.getEvent(event_id).end_date),
							text: scheduler.getEvent(event_id).text,
							id: scheduler.getEvent(event_id).id,
							weekday: weekDay(scheduler.getEvent(event_id).start_date), //what if the event was a multi-day event?!?!
							color: '#34495e'

						},
					});
				};

				var deleteEvent = function(event_id, e) {
					$('.ajaxProgress').show();
					$.ajax({
						type: "POST",
						url: "delete_event/",
						dataType: "json",
						data: {
							csrfmiddlewaretoken: '{{ csrf_token }}',
							id: event_id
						},
					});
					return true;
				};

				scheduler.attachEvent("onEventDeleted", deleteEvent);
				scheduler.attachEvent("onClick", readonly_check);
				scheduler.attachEvent("onDblClick", readonly_check);



				// JS event for the onEventAdded function to do an AJAX call to the database for syncing the new event data
				scheduler.attachEvent("onEventAdded", updateDayStatus);

				scheduler.attachEvent("onEventChanged",function(id,ev){
		    	$('.ajaxProgress').show();
					$.ajax({
						type: "POST",
						url: "update_event/",
						dataType: "json",
						data: {
							csrfmiddlewaretoken: '{{ csrf_token }}',
							start: formatDateFunc(scheduler.getEvent(id).start_date),
							end: formatDateFunc(scheduler.getEvent(id).end_date),
							text: ev.text,
							id: id

						},
					});
		    		return true;
				});

				// Create a new date for gatehring the default times that load into the calendar
				var d = new Date();

				//Get an integer value for getting the full year of the current year in the calendar
				var calendar_year = d.getFullYear();

				//Get the current default month to load into the initial view for the calendar
				var calendar_month = d.getMonth();

				//Get the current day for the calendar to load into the default value for the calendar
				var calendar_day = d.getDate();

				// document.write({{ mon.0 }});


				scheduler.attachEvent("onBeforeDrag", readonly_check);

				// scheduler.config.readonly = true;
				scheduler.init('scheduler_here',new Date(calendar_year,calendar_month,calendar_day),"week");

				scheduler.parse( [
						{% for monday_tasks in mon %}
						{% if monday_tasks.authenticated_user.username == current_user %}
							{
								text: '{{ monday_tasks.task_name }}',
								id: '{{ monday_tasks.special_event_id }}',
								start_date: '{{ monday_tasks.start_time }}'.substring(0, 10)+" "+'{{ monday_tasks.start_time }}'.substring(11, 16),
								end_date: '{{ monday_tasks.end_time }}'.substring(0, 10)+" "+'{{ monday_tasks.end_time }}'.substring(11, 16),
								color: '{{ monday_tasks.color }}'
							},
						{% endif %}
						{% endfor %}
						{% for tuesday_tasks in tues %}
						{% if tuesday_tasks.authenticated_user.username == current_user %}
							{
								text: '{{ tuesday_tasks.task_name }}',
								id: '{{ tuesday_tasks.special_event_id }}',
								start_date: '{{ tuesday_tasks.start_time }}'.substring(0, 10)+" "+'{{ tuesday_tasks.start_time }}'.substring(11, 16),
								end_date: '{{ tuesday_tasks.end_time }}'.substring(0, 10)+" "+'{{ tuesday_tasks.end_time }}'.substring(11, 16),
								color: '{{ tuesday_tasks.color }}'
							},
							{% endif %}
						{% endfor %}
						{% for wednesday_tasks in wed %}
						{% if wednesday_tasks.authenticated_user.username == current_user %}
							{
								text: '{{ wednesday_tasks.task_name }}',
								id: '{{ wednesday_tasks.special_event_id }}',
								start_date: '{{ wednesday_tasks.start_time }}'.substring(0, 10)+" "+'{{ wednesday_tasks.start_time }}'.substring(11, 16),
								end_date: '{{ wednesday_tasks.end_time }}'.substring(0, 10)+" "+'{{ wednesday_tasks.end_time }}'.substring(11, 16),
								color: '{{ wednesday_tasks.color }}'
							},
							{% endif %}
						{% endfor %}
						{% for thursday_tasks in thurs %}
						{% if thursday_tasks.authenticated_user.username == current_user %}
							{
								text: '{{ thursday_tasks.task_name }}',
								id: '{{ thursday_tasks.special_event_id }}',
								start_date: '{{ thursday_tasks.start_time }}'.substring(0, 10)+" "+'{{ thursday_tasks.start_time }}'.substring(11, 16),
								end_date: '{{ thursday_tasks.end_time }}'.substring(0, 10)+" "+'{{ thursday_tasks.end_time }}'.substring(11, 16),
								color: '{{ thursday_tasks.color }}'
							},
							{% endif %}
						{% endfor %}
						{% for friday_tasks in fri %}
						{% if friday_tasks.authenticated_user.username == current_user %}
							{
								text: '{{ friday_tasks.task_name }}',
								id: '{{ friday_tasks.special_event_id }}',
								start_date: '{{ friday_tasks.start_time }}'.substring(0, 10)+" "+'{{ friday_tasks.start_time }}'.substring(11, 16),
								end_date: '{{ friday_tasks.end_time }}'.substring(0, 10)+" "+'{{ friday_tasks.end_time }}'.substring(11, 16),
								color: '{{ friday_tasks.color }}'
							},
							{% endif %}
						{% endfor %}
						{% for saturday_tasks in sat %}
						{% if saturday_tasks.authenticated_user.username == current_user %}
							{
								text: '{{ saturday_tasks.task_name }}',
								id: '{{ saturday_tasks.special_event_id }}',
								start_date: '{{ saturday_tasks.start_time }}'.substring(0, 10)+" "+'{{ saturday_tasks.start_time }}'.substring(11, 16),
								end_date: '{{ saturday_tasks.end_time }}'.substring(0, 10)+" "+'{{ saturday_tasks.end_time }}'.substring(11, 16),
								color: '{{ saturday_tasks.color }}'
							},
							{% endif %}
						{% endfor %}
						{% for sunday_tasks in sun %}
						{% if sunday_tasks.authenticated_user.username == current_user %}
							{
								text: '{{ sunday_tasks.task_name }}',
								id: '{{ sunday_tasks.special_event_id }}',
								start_date: '{{ sunday_tasks.start_time }}'.substring(0, 10)+" "+'{{ sunday_tasks.start_time }}'.substring(11, 16),
								end_date: '{{ sunday_tasks.end_time }}'.substring(0, 10)+" "+'{{ sunday_tasks.end_time }}'.substring(11, 16),
								color: '{{ sunday_tasks.color }}'
							},
							{% endif %}
						{% endfor %}
				], "json");

				//Array to store all the currently gathered google events for the user on the calendar


				//Storing all the google events to enable ability to make read-only
				{% for monday_tasks in mon %}
						{% if monday_tasks.is_google_task %}
							google_ids.push('{{ monday_tasks.special_event_id }}');
						{% endif %}
				{% endfor %}
				{% for tuesday_tasks in tues %}
					{% if tuesday_tasks.is_google_task %}
						google_ids.push('{{ tuesday_tasks.special_event_id }}');
					{% endif %}
				{% endfor %}
				{% for wednesday_tasks in wed %}
					{% if wednesday_tasks.is_google_task %}
						google_ids.push('{{ wednesday_tasks.special_event_id }}');
					{% endif %}
				{% endfor %}
				{% for thursday_tasks in thurs %}
					{% if thursday_tasks.is_google_task %}
						google_ids.push('{{ thursday_tasks.special_event_id }}');
					{% endif %}
				{% endfor %}
				{% for friday_tasks in fri %}
					{% if friday_tasks.is_google_task %}
						google_ids.push('{{ friday_tasks.special_event_id }}');
					{% endif %}
				{% endfor %}
				{% for saturday_tasks in sat %}
					{% if saturday_tasks.is_google_task %}
						google_ids.push('{{ saturday_tasks.special_event_id }}');
					{% endif %}
				{% endfor %}
				{% for sunday_tasks in sun %}
					{% if sunday_tasks.is_google_task %}
						google_ids.push('{{ sunday_tasks.special_event_id }}');
					{% endif %}
				{% endfor %}


				//Function to deal with making google tasks read only
				function readonly_check(id) {

					var found_google_task = false;

					for (i = 0; i < google_ids.length; i++) {
						if (google_ids[i] == id) {
							found_google_task = true;
						}
					}
					if (found_google_task) {
						var readOnly = scheduler.getEvent(id).readonly;
						scheduler.config.drag_move = true;
						scheduler.config.drag_resize = readOnly;
						return false;
					}
					else {
						return true;
					}
				}

			}

			$(function() {
			    $( "#datepicker" ).datepicker({
			      showOn: "button",
			      buttonImage: "{% static 'datepicker/images/calendar.gif' %}",
			      buttonImageOnly: true,
			      buttonText: "Select date",
			      minDate: 0

			    });
			});

			

		</script>


		<style type="text/css" media="screen">
			html, body{
				margin:0px;
				padding:0px;
				height:90%;
			}

			.dhx_calendar_click {
				background-color: #C2D5FC !important;
			}

			.pushdown {
				margin-top: 100px;
			}

			/*CSS for collapsing form*/
			#demoTask{
				padding-top: 10px;
			}

		</style>

		<!-- CSS for percent slider -->
		<style>
			#input-select,
			#input-number {
				padding: 7px;
				margin: 15px 5px 5px;
				width: 70px;
			}
		</style>


</head>
<body onload="init();">

<div class="wrapper">
    <div class="sidebar" data-color="azure" data-image="{% static 'img/DASHBOARD_IMAGES/sidebar-4.jpg' %}">


    	<div class="sidebar-wrapper">
            <div class="logo">
                <a href="http://www.creative-tim.com" class="simple-text">
                    Architasker
                </a>
            </div>

            <ul class="nav">
                <li class="active">
                    <a href="/dashboard">
                        <i class="pe-7s-news-paper"></i>
                        <p>Dashboard</p>
                    </a>
                </li>
                <li>
                    <a href="user.html">
                        <i class="pe-7s-user"></i>
                        <p>User Settings</p>
                    </a>
                </li>
            </ul>
    	</div>
    </div>

    <div class="main-panel">
        <nav class="navbar navbar-default navbar-fixed">
            <div class="container-fluid">
                <div class="navbar-header">
                    <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#navigation-example-2">
                        <span class="sr-only">Toggle navigation</span>
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                    </button>
                    <a class="navbar-brand" href="#">Dashboard</a>
                </div>
                <div class="collapse navbar-collapse">
                    <ul class="nav navbar-nav navbar-left">
                        <li>
                            <a href="#" class="dropdown-toggle" data-toggle="dropdown">
                                <i class="fa fa-dashboard"></i>
                            </a>
                        </li>
                        <!-- <li class="dropdown">
                              <a href="#" class="dropdown-toggle" data-toggle="dropdown">
                                    <i class="fa fa-globe"></i>
                                    <b class="caret"></b>
                                    <span class="notification">5</span>
                              </a>
                              <ul class="dropdown-menu">
                                <li><a href="#">Notification 1</a></li>
                                <li><a href="#">Notification 2</a></li>
                                <li><a href="#">Notification 3</a></li>
                                <li><a href="#">Notification 4</a></li>
                                <li><a href="#">Another notification</a></li>
                              </ul>
                        </li> -->
                        <!-- <li>
                           <a href="">
                                <i class="fa fa-search"></i>
                            </a>
                        </li> -->
                    </ul>

                    <ul class="nav navbar-nav navbar-right">
                        <li>
                           <a href="">
                               Account
                            </a>
                        </li>
                        <!-- <li class="dropdown">
                              <a href="#" class="dropdown-toggle" data-toggle="dropdown">
                                    Dropdown
                                    <b class="caret"></b>
                              </a>
                              <ul class="dropdown-menu">
                                <li><a href="#">Action</a></li>
                                <li><a href="#">Another action</a></li>
                                <li><a href="#">Something</a></li>
                                <li><a href="#">Another action</a></li>
                                <li><a href="#">Something</a></li>
                                <li class="divider"></li>
                                <li><a href="#">Separated link</a></li>
                              </ul>
                        </li> -->
                        <li>
                            <a href="/logout">
                                Log out
                            </a>
                        </li>
                    </ul>
                </div>
            </div>
        </nav>


				<center><h5 class="title">{{first_name | title}} {{last_name | title}}'s Calendar</h5></center>

				<div id="scheduler_here" class="dhx_cal_container card col-md-12" style='width:100%; height:70%'>

					 <div class="dhx_cal_navline">
							<div class="dhx_cal_prev_button">&nbsp;</div>
							<div class="dhx_cal_next_button">&nbsp;</div>
							<div class="dhx_cal_today_button"></div>
							<div class="dhx_cal_date"></div>
							<div class="dhx_cal_tab" name="day_tab" style="right:204px;"></div>
							<div class="dhx_cal_tab rounding_week_tab" name="week_tab" style="right:140px; border-top-right-radius: 5px; border-bottom-right-radius: 5px;"></div>
					 </div>
					 <div class="dhx_cal_header">
					 </div>
					 <div class="dhx_cal_data pushdown">
					 </div>
				</div>

				<div class="container col-lg-12">
				{% if user_is_authenticated == True %}
				<form action="/sync" method="get">
					{% csrf_token %}
				<input type="submit" value="Sync Google Calendar" class="btn waves-effect waves-light pink darken-1" style="float: right;">
				</form>
				{% elif user_is_authenticated == False %}
				<a href="/oauth">Want to sync with Google? Click Here</a>
				{% endif %}

				
				    <a href="#footerID"><button type="button" class="btn btn-success" data-toggle="collapse" data-target="#demoTask">
				      <span class="glyphicon glyphicon-collapse-down"></span> Add Task
				    </button></a>
				  <div id="demoTask" class="collapse">
				  	<section id="advanced-form">
					    <form id="example-advanced-form" action="#">
						    <h3>Task</h3>
						    <section>
						        <legend>Task Information</legend>
						 
						        <label for="taskName-2">Task name *</label>
						        <input id="taskName-2" name="taskName" type="text" class="required">
						        <label for="datepicker">Due Date *</label>
						        <!-- <input id="dueDate-2" name="dueDate" type="text" class="required"> -->
						        <input type="text" id="datepicker" name="dueDate" class="required">
						    </section>
						 
						    <h3>Details</h3>
						    <section>
						    	<legend>Estimated Time &amp; Priority</legend>
						    	<div>
							    	<label for="percent-2">% to complete by end of the week*</label>
							        <!-- <input id="percent-2" name="percent" type="text" class="required"> -->
							        <div>
								        <input type="number" min="0" max="100" step="1" id="input-number" style='display:inline-block;'>
										<div id="html5" style='width:35%; display:inline-block;'></div>
									</div>
								</div>

								<div style='padding-top: 20px'>
							        <label for="time-2">Estimated time (hours) to complete  <div id="valueOfSlider" style='display:inline-block;'></div> of task*</label>
							        <input id="time-2" name="time" type="text" class="required">
							    </div>

							    <div style='padding-top: 20px'>
									<label for="radiosSlider">Priority *</label>
	      							<div id="radiosSlider"  style='width:350%'>
									    <input id="value1" name="values" type="radio">
									    <label for="value1">1</label>

									    <input id="value2" name="values" type="radio">
									    <label for="value2">2</label>

									    <input id="value3" name="values" type="radio">
									    <label for="value3">3</label>

									    <input id="value4" name="values" type="radio">
									    <label for="value4">4</label>

									    <input id="value5" name="values" type="radio" checked>
									    <label for="value5">5</label>

									    <input id="value6" name="values" type="radio">
									    <label for="value6">6</label>

									    <input id="value7" name="values" type="radio">
									    <label for="value7">7</label>

									    <input id="value8" name="values" type="radio">
									    <label for="value8">8</label>

									    <input id="value9" name="values" type="radio">
									    <label for="value9">9</label>

									    <input id="value10" name="values" type="radio">
									    <label for="value10">10</label>
									</div>
								</div>
								
						    </section>
						 
						    <h3>Extras</h3>
						    <section>
						        <legend>Extra Integrations</legend>
						 
						        <input id="pomodoro-2" name="pomodoro" type="checkbox" class="required"> <label for="pomodoro-2">Pomodoro Timer</label>
						    </section>
						</form>
				   	</section>
				  </div>
				</div>

				<script>
				$(document).ready(function(){
				  $("#demoTask").on("hide.bs.collapse", function(){
				    $(".btn").html('<span class="glyphicon glyphicon-collapse-down"></span> Add Task');
				  });
				  $("#demoTask").on("show.bs.collapse", function(){
				    $(".btn").html('<span class="glyphicon glyphicon-collapse-up"></span> Close');
				  });
				});

				
				</script>


        <footer id="footerID" class="footer">
            <div class="container-fluid">
                <nav class="pull-left">
                    <ul>
                        <li>
                            <a href="#">
                                Home
                            </a>
                        </li>
                        <li>
                            <a href="https://architasker.wordpress.com/">
                               Blog
                            </a>
                        </li>
                    </ul>
                </nav>
                <p class="copyright pull-right">
                    &copy; 2015 <a href="http://www.creative-tim.com">Architasker</a>, made with love for a better scheduler
                </p>
            </div>
        </footer>

    </div>
</div>

<script>
        var form = $("#example-advanced-form").show();

        form.steps({
            headerTag: "h3",
            bodyTag: "section",
            transitionEffect: "slideLeft",
            onStepChanging: function (event, currentIndex, newIndex)
            {
                // Allways allow previous action even if the current form is not valid!
                if (currentIndex > newIndex)
                {
                    return true;
                }
                // Forbid next action on "Warning" step if the user is to young
                if (newIndex === 3 && Number($("#age-2").val()) < 18)
                {
                    return false;
                }
                // Needed in some cases if the user went back (clean up)
                if (currentIndex < newIndex)
                {
                    // To remove error styles
                    form.find(".body:eq(" + newIndex + ") label.error").remove();
                    form.find(".body:eq(" + newIndex + ") .error").removeClass("error");
                }
                form.validate().settings.ignore = ":disabled,:hidden";
                return form.valid();
            },
            onStepChanged: function (event, currentIndex, priorIndex)
            {
                // Used to skip the "Warning" step if the user is old enough.
                if (currentIndex === 2 && Number($("#age-2").val()) >= 18)
                {
                    form.steps("next");
                }
                // Used to skip the "Warning" step if the user is old enough and wants to the previous step.
                if (currentIndex === 2 && priorIndex === 3)
                {
                    form.steps("previous");
                }
            },
            onFinishing: function (event, currentIndex)
            {
                form.validate().settings.ignore = ":disabled";
                return form.valid();
            },
            onFinished: function (event, currentIndex)
            {
                alert("Submitted!");
            }
        }).validate({
            errorPlacement: function errorPlacement(error, element) { element.before(error); },
            rules: {
                confirm: {
                    equalTo: "#password-2"
                }
            }
        });

        $(document).ready( function(){
        	$("#radiosSlider").radiosToSlider();
    	});
    </script>

    <!-- Javascript for percent slider -->
    <script>
		var html5Slider = document.getElementById('html5');

		noUiSlider.create(html5Slider, {
			start: 50,
			connect: "lower",
			step: 1,
			range: {
				'min': 0,
				'max': 100
			}
		});

		var inputNumber = document.getElementById('input-number');
		var valueOfSlider = document.getElementById('valueOfSlider');

		html5Slider.noUiSlider.on('update', function( values, handle ) {

			var value = values[handle];
			inputNumber.value = Math.round(value);
			valueOfSlider.innerHTML = Math.round(value) + "%";
		});


		inputNumber.addEventListener('change', function(){
			html5Slider.noUiSlider.set([this.value]);
		});
	</script>
</body>

<!--   Core JS Files   -->
<!-- <script src="{% static 'js/DASHBOARD_JAVASCRIPT/jquery-1.10.2.js'%}" type="text/javascript"></script> -->
<script src="{% static 'js/DASHBOARD_JAVASCRIPT/bootstrap.min.js' %}" type="text/javascript"></script>

<!--  Checkbox, Radio & Switch Plugins -->
<script src="{% static 'js/DASHBOARD_JAVASCRIPT/bootstrap-checkbox-radio-switch.js' %}"></script>

<!--  Charts Plugin -->
<script src="{% static 'js/DASHBOARD_JAVASCRIPT/chartist.min.js' %}"></script>

<!--  Notifications Plugin    -->
<script src="{% static 'js/DASHBOARD_JAVASCRIPT/bootstrap-notify.js' %}"></script>

  <!-- Light Bootstrap Table Core javascript and methods for Demo purpose -->
<script src="{% static 'js/DASHBOARD_JAVASCRIPT/light-bootstrap-dashboard.js' %}"></script>

<!-- Light Bootstrap Table DEMO methods, don't include it in your project! -->
<script src="{% static 'js/DASHBOARD_JAVASCRIPT/demo.js' %}"></script>

	<script type="text/javascript">
			{% if user_login_count == False %}
    	$(document).ready(function(){

        	$.notify({
            	icon: 'pe-7s-bell',
            	message: "Welcome to Architasker! Get started by setting up your account so we can begin adding tasks."

            },{
                type: 'info',
                timer: -1
            });

    	});
		{% endif %}
	</script>

</html>
